---
date:  2023-01-11
title: 使用 npm 管理软件包
tags: 
  - 后端开发 和 APIs
categories:
  - 后端开发 和 APIs
---

npm（Node 包管理工具）是一个命令行工具，用于安装、创建和分享为 Node.js 编写的 JavaScript 代码包。在 npm 上有许多开放源码软件包，所以在项目启动之前，需要一些时间来探索，这样你就不会最后重新创建轮子来处理像日期或从 API 获取数据这样的事项。

在这个课程中，你将学习使用 npm 的基本知识，包括如何使用 `package.json` 和如何管理已安装的依赖项。

# package.json 配置

`package.json` 文件是所有 Node.js 项目和 npm 包的枢纽， 和 HTML 文档中的 `<head>` 部分用来描述网页的配置信息（元数据）一样，它存储你的项目的相关信息。 它由单个 JSON 对象组成，并以键值对的形式存储项目信息， ==且至少包含两个必填字段：“name” 和 “version”——但是最好提供有关项目的其他信息==，这将对用户或者维护者有所帮助。

如果你能找到项目的文件树，那么可以在文件树的最外层找到 package.json， 在接下来的几个挑战中你将完善这个文件。

## 给 package.json 添加作者

在这个文件中最常见的信息之一是 `author` 字段， 它说明了项目的创建者，可以包含一个带有联系人信息或其他信息的字符串或对象。 对于较大的项目，建议使用对象；但是在我们的项目中，一个简单的字符串就够了，比如下面的例子：

```json
"author": "Jane Doe",
```

## 给 package.json 添加描述

一个好的 package.json 文件的下一部分就是 `description` 字段——简短精悍的的项目描述。

如果有一天你打算向 npm 发布一个软件包，当用户决定是否安装你的软件包时，这个字符串就能向用户表明你的想法。 然而，这并不是使用描述的唯一场景：它也是一种很好的总结项目的方式， 可以帮助其它开发者、维护者甚至自己在未来快速地了解项目，对于任何一个 Node.js 项目来说都非常重要。

无论项目计划是什么，都建议使用描述。 类似这样：

```json
"description": "A project that does something awesome",
```

**注意：** 请记住使用双引号（"）包裹字段名并且使用逗号（,）分隔字段。

## 给 package.json 添加关键词

在 `keywords` 字段中可以使用相关的关键字描述项目。 下面是一个示例：

```json
"keywords": [ "descriptive", "related", "words" ],
```

正如你所见的，这个字段的结构是一个由双引号字符串组成的数组。

## 给 package.json 添加许可证

`license` 字段将告知用户允许他们拿这个项目干什么。

开源项目常见的协议有 MIT 和 BSD 等。 许可证信息并不是必须的。 大多数国家的版权法会默认让你拥有自己创作的作品的所有权。 但是，明确说明用户可以做什么和不能做什么会是一个很好的做法。 这里有一个 license 字段的例子：

```json
"license": "MIT",
```

## 给 package.json 添加版本号

`version` 是 package.json 文件中必填字段之一， 这个字段描述了当前项目的版本， 下面是一个示例：

```json
"version": "1.2.0",
```

## 使用 npm 的外部包扩展项目

强大的依赖管理特性是使用包管理器的最大原因之一。 每当在新的计算机上开始一个项目时，无需手动，npm 会自动安装所有的依赖项。 但是 npm 如何准确地知道项目需要哪些依赖呢？ 来看看 package.json 文件中 `dependencies` 这一部分。

在这部分，你的项目需要按照下面这种格式来存储依赖包：

```json
"dependencies": {
  "package-name": "version",
  "express": "4.14.0"
}
```

## 通过语义化版本来管理 npm 依赖关系

在 package.json 文件的依赖项中，npm 包的 `Versions` 遵循语义化版本（SemVer，Semantic Versioning），它是一种旨在使管理依赖项更加容易的软件版本控制的行业标准。 在 npm 上发布的库、框架或其它工具都应该使用语义化版本，以便让用户清晰地知道如果项目升级将带来哪些改变。

在使用外部依赖项（大多数情况都是这样）进行软件开发时，了解语义化版本会很有用。 这些数字保存着项目的偶然发生的破坏性改变，不会让人对项目昨天还正常，今天却无法运行而百思不解。 根据官网，这是语义化版本的工作方式：

```json
"package": "MAJOR.MINOR.PATCH"
```

当做了不兼容的 API 修改，应该增加主版本号（MAJOR）； 当新增了向下兼容的新功能时，应该增加次版本号（MINOR）； 当修复了向下兼容的 bug 时，应该增加修订号（PATCH）。 这意味着修订号是用来修复错误的，次版本号则是添加了新功能，但它们都没有破坏之前的功能。 主版本号（MAJOR）是添加了不兼容早期版本的更改。
## 用波浪号维持依赖项的最新修订号

在上一个挑战中，npm 只包含特定版本的依赖包。 如果想让项目各个部分保持相互兼容，锁定依赖包版本是一个行之有效的办法。 但是大多数情况下，我们并不希望错过依赖项的问题修复，因为它们通常包含重要的安全补丁，而且它们理论上也会兼容我们既有的代码。

可以在依赖项的版本号前加一个波浪号（`~`），以让 npm 依赖项更新到最新的修订版。 这里有一个允许升级到任何 1.3.x 的例子：

```json
"package": "~1.3.8"
```

## 用脱字符（^）来使用依赖项的最新次要版本

和上一个挑战中我们学到的用波浪号来安装最新的修订版依赖一样，脱字符（`^`）也允许 npm 来安装功能更新。 它们的不同之处在于：脱字符允许次版本和修订版更新。

你当前的 `@freecodecamp/example` 版本应该是“~1.2.13”，它允许 npm 安装到最新的 1.2.x 版本。 如果使用插入符号（^）作为版本前缀，npm 将被允许更新到任何 1.x.x 版本。

```json
"package": "^1.3.8"
```

这会将依赖包更新到任意的 1.x.x 版本。

**注意：** 原来的版本号不用更改。